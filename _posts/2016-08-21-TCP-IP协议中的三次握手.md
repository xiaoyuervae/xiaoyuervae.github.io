---
layout: post
title: "TCP/IP协议中的三次握手"
date: 2016-08-14 
description: "xiaoyuervae的博客"
tag: 博客 
---

今天在 `牛客网` 中做阿里巴巴实习生面试题的时候做到了一题。 题目中提到了`TCP/IP`协议的三次握手。

## 沃德天，什么？？？握手，居然还需要三次！！！

于是乎，度娘了一遍寻找答案。

*看了几篇博文。原来不止三次握手，居然还有四次挥手。*

话不多说，看看到底是怎么回事。

### 建立`TCP/IP` connection 需要三次握手，而断开需要四次，看看到底是个什么情况：
![1.jpg](/assets/images/2016-08-21/1.jpg)

⤴️这是建立连接的过程

> 首先Client端发送连接请求报文，Server段接受连接后回复ACK报文，并为这次连接分配资源。Client端接收到ACK报文后也向Server段发生ACK报文，并分配资源，这样TCP连接就建立了。

![2.png](/assets/images/2016-08-21/2.png)

> 假设Client端发起中断连接请求，也就是发送FIN报文。Server端接到FIN报文后，意思是说"我Client端没有数据要发给你了"，但是如果你还有数据没有发送完成，则不必急着关闭Socket，可以继续发送数据。所以你先发送ACK，"告诉Client端，你的请求我收到了，但是我还没准备好，请继续你等我的消息"。这个时候Client端就进入FIN_WAIT状态，继续等待Server端的FIN报文。当Server端确定数据已发送完成，则向Client端发送FIN报文，"告诉Client端，好了，我这边数据发完了，准备好关闭连接了"。Client端收到FIN报文后，"就知道可以关闭连接了，但是他还是不相信网络，怕Server端不知道要关闭，所以发送ACK后进入TIME_WAIT状态，如果Server端没有收到ACK则可以重传。“，Server端收到ACK后，"就知道可以断开连接了"。Client端等待了2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，我Client端也可以关闭连接了。Ok，TCP连接就这样关闭了！

以上。





